
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Time-domain scrambling of audio signals in Matlab</title><meta name="generator" content="MATLAB 7.11"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2010-11-14"><meta name="DC.source" content="demo_scramble.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><a href="http://www.ee.columbia.edu/~dpwe/">Dan Ellis</a> : <a href="http://www.ee.columbia.edu/~dpwe/resources/">Resources</a>: <a href="http://www.ee.columbia.edu/~dpwe/resources/matlab/">Matlab</a>: <div class="content"> <IMG SRC="scramble.jpg" ALIGN="LEFT" HSPACE="10"><h1>Time-domain scrambling of audio signals in Matlab</h1><!--introduction--><p>These routines scramble an audio file by moving around short, overlapping windows within a local window.  They can be used to create new versions of existing recordings that preserve the spectral content over longer time scales, but remove structure at shorter timescales.  This can be useful e.g. for making speech unintelligible.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Simple time-domain scrambling</a></li><li><a href="#2">Multi-band scrambling</a></li><li><a href="#3">Download</a></li><li><a href="#4">Referencing</a></li><li><a href="#5">Acknowledgment</a></li></ul></div><h2>Simple time-domain scrambling<a name="1"></a></h2><p>The main routine <a href="shufflewins.m">shufflewins</a> takes a waveform, chops it into a set of short windows (with 50% overlap), tapers them with a raised cosine window, shuffles them, then re-overlaps them.  The shuffling order is determined by <a href="localperm.m">localperm</a> which behaves like the Matlab built-in randperm, except it controls the distribution of the difference between original and final window positions to be approximately Gaussian with a variance specified by the user.  Breaking the waveform into overlapped short windows is accomplished by <a href="frame.m">frame</a>, and the shuffled windows are reconstructed by <a href="ola.m">ola</a>. Thus, to shuffle a full-band audio signal:</p><pre class="codeinput"><span class="comment">% Load some speech</span>
[d,sr] = wavread(<span class="string">'speech.wav'</span>);
<span class="comment">% Shuffle 25 ms windows over a 250ms radius</span>
y = shufflewins(d,round(sr*.025),round(sr*.25));
<span class="comment">% Listen back</span>
soundsc(y,sr);
</pre><h2>Multi-band scrambling<a name="2"></a></h2><p>For added scrambling, the signal can be broken into multiple frequency bands, separately scrambled in each band, then recombined.  A suitable choice for frequency decomposition is to use gammatone filters, which are a linear approximation to the frequency resolution of the ear.  We used slightly-modified versions of <a href="MakeERBFilters.m">MakeERBFilters</a> and <a href="ERBFilterBank.m">ERBFilterBank</a> (which rely on <a href="ERBSpace.m">ERBSpace</a>) from Malcolm Slaney's <a href="http://cobweb.ecn.purdue.edu/~malcolm/interval/1998-010/">Auditory Toolbox</a> The modifications are to allow us to use "time-reversed filtering" to remove the phase effects of the Gammatone ERB filters: we design the filters to have wider bandwidth than normal, then we filter each band twice, once forwards and once backwards in time.</p><pre class="codeinput"><span class="comment">% Set up Gammatone filterbank with 64 bands from Nyquist to 50 Hz</span>
<span class="comment">% Scale bandwidths to be 1.5 x normal, so the effect of filtering</span>
<span class="comment">% both forward and backwards is approximately the bandwidth of a</span>
<span class="comment">% single forward pass, at least in the top 10 dB.</span>
fcoefs = MakeERBFilters(sr,64,50,1.5);
<span class="comment">% Break the speech into subbands using the filters</span>
<span class="comment">% Each row of dsub is one of the 64 band-passed signals</span>
dsub = ERBFilterBank(d,fcoefs);
<span class="comment">% Pass each subband signal back through the same filter, but</span>
<span class="comment">% backwards in time, then flip them again</span>
dsub2 = fliplr(ERBFilterBank(fliplr(dsub),fcoefs));
<span class="comment">% sum(dsub2) is now a pretty good approximation to the original d</span>
soundsc(sum(dsub2),sr);
<span class="comment">% .. but now we can scramble each subband independently</span>
<span class="keyword">for</span> i = 1:size(dsub2,1); <span class="keyword">...</span>
    ysub(i,:) = shufflewins(dsub2(i,:),round(sr*.025),round(sr*.25)); <span class="keyword">...</span>
<span class="keyword">end</span>
<span class="comment">% sum up scrambled subbands to get a full-band signal</span>
y2 = sum(ysub);
<span class="comment">% take a listen</span>
soundsc(y2,sr);
<span class="comment">% Plot the results</span>
subplot(311)
specgram(d,512,sr);
caxis([-50 10]);
title(<span class="string">'original'</span>);
subplot(312)
specgram(y,512,sr);
caxis([-50 10]);
title(<span class="string">'full-band scrambling'</span>);
subplot(313)
specgram(y2,512,sr);
caxis([-50 10]);
title(<span class="string">'multiband scrambling'</span>);
</pre><img vspace="5" hspace="5" src="demo_scramble_01.png" alt=""> <h2>Download<a name="3"></a></h2><p>You can download all the code and data for these examples here: <a href="scramble.tgz">scramble.tgz</a>.</p><h2>Referencing<a name="4"></a></h2><p>If you use this work in a publication, I would be grateful if you referenced this page as follows:</p><p>
<UL>
D. P. W. Ellis (2010).
<A HREF="http://www.ee.columbia.edu/~dpwe/resources/matlab/scramble/">Time-domain scrambling of audio signals in Matlab"</A>,<BR>
web resource:
http://www.ee.columbia.edu/~dpwe/resources/matlab/scramble/
</UL>
</p><p>We first proposed spectrum-preserving, intelligibility-removing scrambling for privacy protection of audio lifelogs in:</p><p>
<UL>
D. Ellis and K.S. Lee (2004).
<A HREF="http://www.ee.columbia.edu/~dpwe/pubs/carpe04-minimpact.pdf"> "Minimal-Impact Audio-Based Personal Archives"</A>, <BR>
<I>First ACM workshop on Continuous Archiving and Recording of Personal Experiences CARPE-04</I>, <BR>
New York, Oct 2004, pp. 39-47.
</UL>
</p><p>We got the idea of applying this independently in Gammatone subbands from:</p><p>
<UL>
Y. Minagawa-Kawai, H. van der Lely, F. Ramus, Y. Sato, R. Mazuka,
and E. Dupoux (2010).  <BR>
<A HREF="http://cercor.oxfordjournals.org/content/early/2010/05/22/cercor.bhq082.abstract"> "Optical Brain Imaging Reveals General Auditory and Language-Specific Processing in Early Infant Development"</A>,<BR>
<I>Cereb. Cortex</I>, advance access, 2010.
</UL>
</p><h2>Acknowledgment<a name="5"></a></h2><p>This project was supported in part by the NSF under grant IIS-0716203. Any opinions, findings and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the Sponsors.</p><pre class="codeinput"><span class="comment">% Last updated: $Date: 2010/11/14 01:23:46 $</span>
<span class="comment">% Dan Ellis &lt;dpwe@ee.columbia.edu&gt;</span>
</pre><p class="footer"><br>
      Published with MATLAB&reg; 7.11<br></p></div><!--
##### SOURCE BEGIN #####
%% Time-domain scrambling of audio signals in Matlab
% These routines scramble an audio file by moving around short, 
% overlapping windows within a local window.  They can be used 
% to create new versions of existing recordings that preserve 
% the spectral content over longer time scales, but remove 
% structure at shorter timescales.  This can be useful e.g. for 
% making speech unintelligible.

%% Simple time-domain scrambling
% The main routine <shufflewins.m shufflewins> takes a waveform, 
% chops it into a set of short windows (with 50% overlap), 
% tapers them with a raised cosine window, shuffles them, then 
% re-overlaps them.  The shuffling order is determined by 
% <localperm.m localperm> which behaves like the Matlab 
% built-in randperm, except it controls the distribution of the
% difference between 
% original and final window positions to be approximately Gaussian 
% with a variance specified by the user.  Breaking the waveform
% into overlapped short windows is accomplished by <frame.m frame>,
% and the shuffled windows are reconstructed by <ola.m ola>. 
% Thus, to shuffle a full-band audio signal:

% Load some speech
[d,sr] = wavread('speech.wav');
% Shuffle 25 ms windows over a 250ms radius
y = shufflewins(d,round(sr*.025),round(sr*.25));
% Listen back
soundsc(y,sr);

%% Multi-band scrambling
% For added scrambling, the signal can be broken into multiple 
% frequency bands, separately scrambled in each band, then 
% recombined.  A suitable choice for frequency decomposition 
% is to use gammatone filters, which are a linear approximation 
% to the frequency resolution of the ear.  We used
% slightly-modified versions of <MakeERBFilters.m MakeERBFilters>
% and  
% <ERBFilterBank.m ERBFilterBank> (which rely on 
% <ERBSpace.m ERBSpace>) from Malcolm Slaney's
% <http://cobweb.ecn.purdue.edu/~malcolm/interval/1998-010/ Auditory Toolbox>
% The modifications are to allow us to use "time-reversed 
% filtering" to remove the phase effects of the Gammatone ERB 
% filters: we design the filters to have wider bandwidth than 
% normal, then we filter each band twice, once forwards and once 
% backwards in time.  

% Set up Gammatone filterbank with 64 bands from Nyquist to 50 Hz
% Scale bandwidths to be 1.5 x normal, so the effect of filtering 
% both forward and backwards is approximately the bandwidth of a 
% single forward pass, at least in the top 10 dB.
fcoefs = MakeERBFilters(sr,64,50,1.5);
% Break the speech into subbands using the filters
% Each row of dsub is one of the 64 band-passed signals
dsub = ERBFilterBank(d,fcoefs);
% Pass each subband signal back through the same filter, but
% backwards in time, then flip them again
dsub2 = fliplr(ERBFilterBank(fliplr(dsub),fcoefs));
% sum(dsub2) is now a pretty good approximation to the original d
soundsc(sum(dsub2),sr);
% .. but now we can scramble each subband independently
for i = 1:size(dsub2,1); ...
    ysub(i,:) = shufflewins(dsub2(i,:),round(sr*.025),round(sr*.25)); ...
end
% sum up scrambled subbands to get a full-band signal
y2 = sum(ysub);
% take a listen
soundsc(y2,sr);
% Plot the results
subplot(311)
specgram(d,512,sr);
caxis([-50 10]);
title('original');
subplot(312)
specgram(y,512,sr);
caxis([-50 10]);
title('full-band scrambling');
subplot(313)
specgram(y2,512,sr);
caxis([-50 10]);
title('multiband scrambling');

%% Download
% You can download all the code and data for these examples here:
% <scramble.tgz scramble.tgz>.

%% Referencing
% If you use this work in a publication, I would be grateful 
% if you referenced this page as follows:
%
% <html>
% <UL>
% D. P. W. Ellis (2010).  
% <A HREF="http://www.ee.columbia.edu/~dpwe/resources/matlab/scramble/">Time-domain scrambling of audio signals in Matlab"</A>,<BR> 
% web resource:
% http://www.ee.columbia.edu/~dpwe/resources/matlab/scramble/
% </UL>
% </html>
%
% We first proposed spectrum-preserving, intelligibility-removing 
% scrambling for privacy protection of audio lifelogs in:
%
% <html>
% <UL>
% D. Ellis and K.S. Lee (2004).  
% <A HREF="http://www.ee.columbia.edu/~dpwe/pubs/carpe04-minimpact.pdf"> "Minimal-Impact Audio-Based Personal Archives"</A>, <BR>
% <I>First ACM workshop on Continuous Archiving and Recording of Personal Experiences CARPE-04</I>, <BR>
% New York, Oct 2004, pp. 39-47.  
% </UL>
% </html>
%
% We got the idea of applying this independently in Gammatone subbands 
% from:
%
% <html>
% <UL>
% Y. Minagawa-Kawai, H. van der Lely, F. Ramus, Y. Sato, R. Mazuka,
% and E. Dupoux (2010).  <BR>
% <A HREF="http://cercor.oxfordjournals.org/content/early/2010/05/22/cercor.bhq082.abstract"> "Optical Brain Imaging Reveals General Auditory and Language-Specific Processing in Early Infant Development"</A>,<BR> 
% <I>Cereb. Cortex</I>, advance access, 2010.
% </UL>
% </html>

%% Acknowledgment
% This project was supported in part by the NSF under 
% grant IIS-0716203. Any opinions, findings and conclusions 
% or recommendations expressed in this material are those of the 
% authors and do not necessarily reflect the views of the Sponsors.

% Last updated: $Date: 2010/11/14 01:23:46 $
% Dan Ellis <dpwe@ee.columbia.edu>

##### SOURCE END #####
--></body></html>
